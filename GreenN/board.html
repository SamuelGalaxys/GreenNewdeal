<!doctype html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>그린 게시판</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="manifest" href="site.webmanifest"> -->
    <!-- Place favicon.ico in the root directory -->


    <script src="js/includeHTML.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- CSS here -->
   

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/nice-select.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/gijgo.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/slicknav.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- <link rel="stylesheet" href="css/responsive.css"> -->
</head>
<body>
    <!--[if lte IE 9]>
             <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
         <![endif]-->
    <!-- header-start -->
    <header include-html="header.html"></header>












    <!-- header-end -->
    <!-- bradcam_area  -->
    <div class="bradcam_area">
        <div class="bradcam_shap">
            <img src="img/ilstrator/bradcam_ils.png" alt="">
        </div>
        <div class="container">
            <div class="row">
                <div class="col-xl-12">
                    <div class="bradcam_text text-center">
                        <h3>그린 게시판</h3>
                        <nav class="brad_cam_lists">
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                                <li class="breadcrumb-item active" aria-current="page">-</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /bradcam_area  -->
    <!--================Blog Area =================-->
    <section class="blog_area single-post-area section-padding">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 posts-list">
                    <div class="single-post">


                        <div class="feature-img">
                            <img class="img-fluid" src="img/blog/single_blog_1.png" alt="">
                        </div>
                        <div class="blog_details">
                            <h2>
                                글을 써보세요.
                            </h2>


                        </div>
                    </div>





                    <!-- 쓰기 텍스트 필드 시작-->



                    <div class="container">

                        <div class="form-group">
                            <label for="comment">게시물 쓰기:</label>


                            

                            <textarea class="form-control w-100" rows="5" name="comment" id="comment" cols="30" placeholder="Write Comment"></textarea>

                            <br>
                            <!-- 쓰기 버튼 가운데 정렬 -->
                            <div class="form-group">

                                <button type="button" class="button button-contactForm btn_1 boxed-btn btn btn-success write" id="write" name="write">쓰기</button>
                            </div>


                        </div>
                    </div>





                    <!-- 쓰기 텍스트 필드 끝-->
                    <!-- 리스트 출력하기-->
                    <div class="container">
                        <hr>
                        <h4>Comments</h4>
                        <br>
                        <!-- 리스트 붙일 곳 -->
                        <div class="thanksList"></div>


                    </div>







                </div>
                <div class="col-lg-4">
                    <div class="blog_right_sidebar">

                        <a id="joinmenu" href="#">가입</a>
                        <a id="loginmenu" href="loginform.html">로그인</a>



                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--================ Blog Area end =================-->
    <!-- footer start -->
    <footer class="footer"></footer>
    <!--/ footer end  -->
    <!-- JS here -->
    <!--현재 시간을 가져오는 js 파일 -->
    <script src="js/time.js"></script>
    <!--login유무 session js 파일 -->
    <script src="js/sessionCheck.js"></script>
    <!--스크립트 부분. 자신의 스크립트 코드로 변경하세요! -->
    <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
    <script>
        var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
        var firebaseDatabase; //파이어베이스 db 모듈 전역변수
        var name; //유저 이름
        var loginUserKey; //로그인한 유저의 부모 key
        var userInfo; //로그인한 유저의 정보 object type

        //파이어 베이스 초기화 코드
        var config = {
            apiKey: "AIzaSyB8r-4Je7eGofLDKDiTpEppdAp9cItLLug",
            authDomain: "webnote-59e75.firebaseapp.com",
            databaseURL: "https://webnote-59e75.firebaseio.com",
            projectId: "webnote-59e75",
            storageBucket: "webnote-59e75.appspot.com",
            messagingSenderId: "1076614864624",
            appId: "1:1076614864624:web:d1d61eb0ff82cb2aba2c35",
            measurementId: "G-7DW85B53L3"
        };
        //파이어베이스 초기화
        firebase.initializeApp(config);
        //인증모듈 객체 가져오기
        firebaseEmailAuth = firebase.auth();
        //데이터베이스 모듈객체 가져오기
        firebaseDatabase = firebase.database();

        //세션 체크 함수
        userSessionCheck();



        $(document).ready(function () {

            //메인화면 쓰기버튼 눌렀을 때
            $(document).on('click', '.write', function () {

                //네비게이션 메뉴의 text값 가져오기 - 자바스크립트 dom 방식으로 가져왔다.
                var seseionCheck = document.getElementById("loginmenu").textContent;

                //내가 쓴글 가져오기 - jquery방식으로 가져왔다.
                comment = $('#comment').val();
                if (seseionCheck == "로그아웃") {
                    //저장하기
                    saveThanks();
                } else {
                    alert("로그인이 필요한 서비스 입니다.")
                }
            });
        });



        //쓰기 버튼 눌렀을 때 호출 되는 함수
        function saveThanks() {

            //thanks 라는 테이블을 만들고 하위 데이터에 유저 아이디를 넣어준다. 그곳에 push로 가상의 키를 넣고, 객체를 넣어준다.!!!!
            var thankRef = firebaseDatabase.ref("thanks");

            // 해당 객체의 key 값이 자동으로 생성된다.
            var thank = thankRef.push(); // 해당 객체의 key 값이 자동으로 생성된다.

            //로그인한 유저의 pk값,이름,내용,시간 데이터
            var obj = {
                userkey: loginUserKey,
                name: name,
                comment: comment,
                createtime: currentTime
            };
            //위에서 thankRef.push()로 만들어진 key아래 위치에 저장해준다.
            thank.set(obj);

            alert("또 하나의 행복이 쌓였습니다.");

            $('#comment').val("");
        }



        //글 목록가져와서 뿌려주기
        function thanksList() {
            alert("thanksList")

            //로그인한 유저라면
            if (loginUserKey) {
                alert(loginUserKey)
                //글이 저장된 레퍼런스 값 가져오기
                var thanksRef = firebaseDatabase.ref('thanks');
                //on 함수로 글 목록가져오기
                thanksRef.on('child_added', on_thanks_list)

            } else {
                //로그인 아니어도 글 보이게
                alert(loginUserKey)
                //글이 저장된 레퍼런스 값 가져오기
                var thanksRef = firebaseDatabase.ref('thanks');
                //on 함수로 글 목록가져오기
                thanksRef.on('child_added', on_thanks_list)
            }

        }

        //게시판 리스트 thanks 테이블의 thanks 키 들을 연속적으로 가져옴...ㅋㅋㅋㅋㅋ
        function on_thanks_list(data) {
            console.log("on_thanks_list() 함수안으로 들어왔습니다 리스트를 가져오겠습니다")
            var key = data.key;

            var Data = data.val();
            var comment = Data.comment;
            var createtime = Data.createtime;
            var name = Data.name;
            var userkey = Data.userkey;

            //무슨값이 넘어오는지 찍어보세요
            //alert(comment +"/"+ createtime + "/"+name +"/"+userkey);


            //리스트 동적으로 붙이기
            var html =
                "<div class=\"media\" id='" + userkey + "' onclick=\"show_user_page(this.id)\">" +
                "<div class=\"media-body\">" +
                "<h4 class=\"media-heading\"><strong STYLE=\"color: #424242;\">" + name + "</strong>" +
                " <span STYLE=\"color: gray; font-size: 11pt\">" + " " + createtime + "</span></h4>" +
                "<p>" + comment + "</p></div></div>" +
                "<hr>";

            $(".thanksList").append(html);

        }


    </script>



    <script src="js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="js/vendor/jquery-1.12.4.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/ajax-form.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <script src="js/scrollIt.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/nice-select.min.js"></script>
    <script src="js/jquery.slicknav.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/gijgo.min.js"></script>
    <script>
        includeHTML();
    </script>
    <!--contact js-->
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
